commands:
    01_install_supervisor:
        command: rpm -qa | grep supervisor || sudo amazon-linux-extras install -y epel && yum -y install supervisor

services:
    sysvinit:
        supervisord:
            enabled: "true"
            ensureRunning: "true"
            files:
                - "/etc/supervisord.d/qrla-queue.ini"

files:
    /etc/supervisord.d/qrla-queue.ini:
        mode: "000644"
        owner: root
        group: root
        content: |
            [program:laravel-worker]
            process_name=%(program_name)s_%(process_num)02d
            command=php /var/app/current/artisan queue:work --sleep=4 --tries=3 --max-time=3600
            autostart=true
            autorestart=true
            stopasgroup=true
            killasgroup=true
            user=root
            numprocs=5
            stdout_logfile=/var/log/qrla-queue-supervisor.log
            stopwaitsecs=3600
